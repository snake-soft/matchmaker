{% extends 'base.html' %}
{% block title %}
Matchmaker
{% endblock %}
{% block var_link %}{% endblock %}


{% block head %}
<style>
#id_count li{
	float:left;
	margin-right: 10px;
}
#id_count label{
	margin: 0;
}
</style>
<script>
function loadDataTables(){
    var t = $('#matchmaker-result-table').DataTable( {
    	"columnDefs": [ {
    		"searchable": false,
    		"orderable": true,
    		"targets": 0
    	} ],
    	"order": [[ 2, 'asc' ]]
    } );
}

function increment(element){
	$(element).get(0).value++; loadMatchRealtime();
}

function decrement(element){
	if ($(element).val() > 0){
		$(element).get(0).value--; loadMatchRealtime();
	}
}
</script>
{% endblock %} 


{% block content %}
{% load join_by_attr %}
<div id="matchmaker" class="container">
	<form method="get">
		<div class="alert alert-success" role="alert">
			You can choose more players than really playing.
		</div>
		<table class="table table-striped table-bordered table-hover">
		    {{ matchmaker_form.as_table }}
		</table>
	    <input class="btn btn-primary btn-block" type="submit" value="Calculate Teams" />
	</form>
</div>

{% if constellations %}
<div id="matchmaker-result" class="table-responsive">
<table id="matchmaker-result-table" class="table table-striped table-bordered table-hover">
<thead>
	<tr>
		<th>Team 1 ({{ constellations.0.team1.players|length }}p.)</th>

		<th>Team 2 ({{ constellations.0.team2.players|length }}p.)</th>

		<th>Dif.</th>
		<th>Play this match</th>
	</tr>
</thead>

{% for constellation in constellations %}
<tr>
<td data-order="{{ team.team_rating_as_int }}"><strong>
	{% if constellation.team1.team.name != None %}
		<a href='/team/{{ constellation.team1.team.id }}/'>
	{{ constellation.team1.team.name }}
	{% else %}
		<a href='/new/team/?players={{constellation.team1.player_ids|join:","}}&next={{request.path}}' type="button" class="btn btn-warning">Create Team
	{% endif %}
	({{ constellation.team1.strength }})</a></strong>

	{% if not constellation.team1.team.is_player_team or not constellation.team1.team.name %}
	<ul>
	{% for player in constellation.team1.players %}
		<li><a href="/player/{{player.pk}}/">{{player.nick}} ({{player.rating_as_int}})</a></li>
	{% endfor %}
	</ul>
	{% endif %}
</td>

<td data-order="{{ team.team_rating_as_int }}"><strong>
	{% if constellation.team2.team.name %}
		<a href='/team/{{ constellation.team1.team.id }}/'>
	{{ constellation.team2.team.name }}
	{% else %}
		<a href='/new/team/?players={{constellation.team1.player_ids|join:","}}&next={{request.path}}' type="button" class="btn btn-warning">Create Team
	{% endif %}
	({{ constellation.team2.strength }})</a></strong>

	{% if not constellation.team2.team.is_player_team or not constellation.team2.team.name %}
	<ul>
	{% for player in constellation.team2.players %}
		<li><a href="/player/{{player.pk}}/">{{player.nick}} ({{player.rating_as_int}})</a></li>
	{% endfor %}
	</ul>
	{% endif %}
</td>

<td><strong>{{ constellation.difference }}</strong></td>
<td>
	{% if constellation.team1.team.name != None and constellation.team2.team.name != None %}
		<a href='/new/match/?firstteam={{constellation.team1.team.id}}&secondteam={{constellation.team2.team.id}}' type="button" class="btn btn-success">Start</a>
	{% else %}
		<div class="alert alert-info" role="alert">
			Create Teams first
		</div></button>
	{% endif %}
</td>
</tr>

{% empty %}

    <li>No constellations .</li>

{% endfor %}

</table>
</div>
{% endif %}
{% endblock %} 