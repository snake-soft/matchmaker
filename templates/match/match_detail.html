{% extends 'base.html' %}
{% block title %}Match details #{{object.pk}}{% endblock %}
{% block var_link %}{% endblock %}


{% block head %}
<script>
function loadDataTables(){
    var t = $('#player-detail').DataTable( {
    	"ordering": false,
    	"searching": false,
    	"columnDefs": [ {
    		"searchable": false,
    		"orderable": false,
    		"targets": 0
    	} ],
    	"order": [[ 1, 'asc' ]]
    } );
    t.on( 'order.dt search.dt', function () {
    	t.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
    		cell.innerHTML = i+1;
    	} );
    } ).draw();
}
</script>
{% endblock %}


{% block content %}
{% load humanize join_by_attr dict_get attrib_get signed %}
<h1>Match Detail</h1>
<div class="table-responsive">
<table class="table table-striped table-bordered table-hover" >
	<thead>
		<tr>
			<th>ID</th>
			<th>Time</th>
			<th>First team</th>
			<th>Second team</th>
			<th>Result</th>
			<th>Difference</th>
		</tr>
	</thead>
    <tr>
    	<th><a href="{% url 'match-details' object.pk %}">{{ object.pk }}</a></th>
    	<td>{{ object.date_time|naturaltime }}</td>
    	<td>
    		<a href="{% url 'team-details' object.firstteam.pk %}">{{object.firstteam.get_team_name_or_members}} ({{object.firstteam.team_rating_as_int}})</a>
    		<br /><br />Players:
    		<ul>{% for player in object.firstteam.players.all %}<li><a href="{% url 'player-details' player.pk %}">{{player.nick}}
				({{player.rating_as_int}}{% if player.pk in player_realtime.keys %}{{ player_realtime|dict_get:player.pk|attrib_get:'elo_diff'|signed}}={{ player_realtime|dict_get:player.pk|attrib_get:'elo_as_int'}}{% endif%})</a></li>
	   	    {% endfor %}</ul>
    	</td>
    	<td>
    		<a href="{% url 'team-details' object.secondteam.pk %}">{{object.secondteam.get_team_name_or_members}} ({{object.secondteam.team_rating_as_int}})</a>
    		<br /><br />Players:
    		<ul>{% for player in object.secondteam.players.all %}<li><a href="{% url 'player-details' player.pk %}">{{player.nick}}
				({{player.rating_as_int}}{% if player.pk in player_realtime.keys %}{{ player_realtime|dict_get:player.pk|attrib_get:'elo_diff'|signed}}={{ player_realtime|dict_get:player.pk|attrib_get:'elo_as_int'}}{% endif%})</a></li>
	   	    {% endfor %}</ul>
    	</td>
    	<td>{{ object.firstteam_goals}}:{{ object.secondteam_goals}}</td>
    	<td>{{ object.goal_difference}}</td>
</table>
</div>
<br />
<h2>Rematches</h2>
<div class="table-responsive">
<table id="player-overview" class="table table-striped table-bordered table-hover" >
	<thead>
		<tr>
			<th>ID</th>
			<th>Time</th>
			<th>First team</th>
			<th>Second team</th>
			<th>Result</th>
			<th>Difference</th>
		</tr>
	</thead>
	{% for match in object.rematches %}
    <tr>
    	<th><a href="{% url 'match-details' match.pk %}">{{ match.pk }}</a></th>
    	<td title="{{match.date_time}}">{{ match.date_time|naturaltime }}</td>
    	<td title="{{match.firstteam}}"><a href="{% url 'team-details' match.firstteam.pk %}">{{match.firstteam.get_team_name_or_members }}</a></td>
    	<td title="{{match.secondteam}}"><a href="{% url 'team-details' match.firstteam.pk %}">{{ match.secondteam.get_team_name_or_members }}</a></td>
    	<td>{{ match.firstteam_goals}}:{{ match.secondteam_goals}}</td>
    	<td>{{ match.goal_difference}}</td>
	</tr>
	{% endfor %}
</table>
</div>
{% endblock %} 